<div id="travel-index"></div>

<style>
#travel-index{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
.ti-card{border:1px solid #e5e5e5;border-radius:12px;background:#fff;padding:12px}
.ti-h{margin:0 0 10px 0;font:600 16px/1.3 system-ui,Arial}
.ti-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
.ti-item{display:block;text-decoration:none;color:#111;border:1px solid #eee;border-radius:10px;overflow:hidden;background:#fafafa}
.ti-thumb{width:100%;aspect-ratio:4/3;object-fit:cover;background:#f2f2f2;display:block}
.ti-ph{width:100%;aspect-ratio:4/3;display:flex;align-items:center;justify-content:center;
       font:700 42px/1 system-ui,Arial;color:#fff;letter-spacing:.5px}
.ti-title{display:block;padding:8px 10px;font:500 13px/1.3 system-ui,Arial}
.ti-more{display:inline-block;margin-top:10px;font:500 13px/1 system-ui,Arial}
</style>

<script>
(function(){
 // 1) Configure your boxes here. Add or edit freely.

const BOXES = [
  // SPAIN
  { title: "Country: Spain", keywords: ["Spain", "Barcelona", "Madrid", "Toledo", "Catalonia", "Catalunya", "La Rambla", "Gothic Quarter", "Montjuic", "Montjuïc", "Sagrada Familia", "Sagrada Família", "Ciutadella", "Barceloneta", "Plaza Mayor", "Prado", "Reina Sofia", "Reina Sofía", "Retiro Park", "Templo de Debod", "Kio Towers", "Bernabéu", "Real Madrid"] },
  { title: "City: Barcelona", keywords: ["Barcelona", "Montjuic", "Montjuïc", "Sagrada Familia", "Sagrada Família", "Picasso Museum", "Barceloneta", "Ciutadella", "La Rambla", "Columbus Monument"] },
  { title: "City: Madrid", keywords: ["Madrid", "Plaza Mayor", "Royal Palace", "Prado", "Reina Sofia", "Reina Sofía", "Retiro", "Santiago Bernabéu", "Templo de Debod", "Atocha", "Kio Towers"] },
  { title: "City: Toledo", keywords: ["Toledo", "Alcázar", "Cathedral", "Zocodover"] },

  // ITALY
  { title: "Country: Italy", keywords: ["Italy", "Rome", "Vatican City", "Florence", "Firenze", "Pisa", "Venice", "Venezia", "Naples", "Napoli", "Pompeii", "Pompei", "Capri", "Amalfi", "Positano", "Paestum", "Modena", "Maranello", "Fiorano"] },
  { title: "City: Rome", keywords: ["Rome", "Colosseum", "Roman Forum", "Palatine", "Campo de' Fiori", "Altar of the Fatherland", "Trajan", "Capitoline", "Ara Coeli"] },
  { title: "City: Vatican City", keywords: ["Vatican", "Vatican City", "St. Peter", "Sistine Chapel", "Musei Vaticani"] },
  { title: "City: Florence", keywords: ["Florence", "Firenze", "Duomo", "Uffizi", "Ponte Vecchio", "Michelangelo"] },
  { title: "City: Pisa", keywords: ["Pisa", "Leaning Tower", "Campo dei Miracoli"] },
  { title: "City: Venice", keywords: ["Venice", "Venezia", "Grand Canal", "St. Mark", "Rialto"] },
  { title: "City: Naples", keywords: ["Naples", "Napoli", "Archaeological Museum", "Bay of Naples", "pizza"] },
  { title: "City: Pompeii", keywords: ["Pompeii", "Pompei", "Vesuvius", "Mt. Vesuvius"] },
  { title: "City: Capri", keywords: ["Capri", "Blue Grotto", "Anacapri"] },
  { title: "Region: Amalfi Coast", keywords: ["Amalfi", "Positano", "Ravello", "Sorrento", "Praiano"] },
   // { title: "City: Modena", keywords: ["Modena", "Enzo Ferrari Museum"] },
    //{ title: "City: Maranello", keywords: ["Maranello", "Ferrari Museum", "Fiorano"] },

  // FRANCE
  { title: "Country: France", keywords: ["France", "Paris", "Montmartre", "Louvre", "Musée d'Orsay", "Champs-Élysées", "Île de la Cité"] },
  { title: "City: Paris", keywords: ["Paris", "Eiffel Tower", "Montmartre", "Louvre", "Musée d'Orsay", "Notre-Dame", "Seine"] },

  // UNITED KINGDOM
  { title: "Country: United Kingdom", keywords: ["United Kingdom", "UK", "England", "London"] },
  { title: "City: London", keywords: ["London", "Westminster", "Thames", "Trafalgar", "Covent Garden"] },

  // IRELAND
  { title: "Country: Ireland", keywords: ["Ireland", "Dublin", "Guinness", "Dublin Castle", "Chester Beatty"] },
  { title: "City: Dublin", keywords: ["Dublin", "Guinness", "Dublin Castle", "Chester Beatty"] },

  // NETHERLANDS
  { title: "Country: Netherlands", keywords: ["Netherlands", "Holland", "Amsterdam", "Singel", "Vondelpark", "Van Gogh Museum"] },
  { title: "City: Amsterdam", keywords: ["Amsterdam", "Singel", "Vondelpark", "Van Gogh Museum", "Red Light"] },

  // BELGIUM
  { title: "Country: Belgium", keywords: ["Belgium", "Grand Place", "Atomium", "Mini-Europe", "EU", "Brussels"] },
  { title: "City: Brussels", keywords: ["Brussels", "Grand Place", "Atomium", "Mini-Europe", "EU"] },

  // SWITZERLAND
  { title: "Country: Switzerland", keywords: ["Switzerland", "Zurich", "Zürich", "Basel", "Fribourg"] },
  { title: "City: Zurich", keywords: ["Zurich", "Zürich"] },
  { title: "City: Basel", keywords: ["Basel"] },

  // GERMANY
  { title: "Country: Germany", keywords: ["Germany", "Munich", "Octoberfest", "Black Forest", "Baden-Baden", "Titisee", "Freiburg"] },
  { title: "Region: Black Forest", keywords: ["Black Forest", "Freiburg", "Titisee", "Baden-Baden"] },
  { title: "City: Munich", keywords: ["Munich", "Octoberfest", "München"] },

  // CANADA
  { title: "Country: Canada", keywords: ["Canada", "Montreal", "Montréal", "Vancouver", "Quebec"] },
  { title: "City: Montreal", keywords: ["Montreal", "Montréal", "Old Montreal"] },

  // MEXICO
  { title: "Country: Mexico", keywords: ["Mexico", "Cozumel"] },
    //{ title: "City: Cozumel", keywords: ["Cozumel"] },

  // BAHAMAS
  { title: "Country: Bahamas", keywords: ["Bahamas", "Castaway Cay"] },
   // { title: "Island: Castaway Cay", keywords: ["Castaway Cay", "Disney island"] },

  // UNITED STATES
  { title: "Country: United States", keywords: ["United States", "USA", "Outer Banks", "North Carolina", "Kill Devil Hills", "Manteo", "Halifax", "New York", "Philadelphia", "Arizona", "Sedona", "Vegas", "Angeles", "Seattle", "Portland", "Washington", "LaGuardia", "Wright Brothers"] },
    //{ title: "Region: Outer Banks", keywords: ["Outer Banks", "OBX", "Kill Devil Hills", "Wright Brothers", "Manteo", "Dare County"] },
  { title: "City: New York", keywords: ["New York", "NYC", "LaGuardia"] }
];


  // 2) Limits and behavior.
  const MAX_PER_BOX = 4;
  const MAX_TO_FETCH = 1500;
  const PAGE_SIZE = 500;
  const MULTI_MATCH = true;

  const root = document.getElementById('travel-index');
  const boxesState = BOXES.map(b => ({title:b.title, keywords:b.keywords, posts:[]}));

  function searchUrl(keywords){
    const q = keywords.map(k => `"${k}"`).join(' OR ');
    return `/?q=${encodeURIComponent(q)}`;
  }
  function matches(entryText, keywords){
    const t = entryText.toLowerCase();
    return keywords.some(k => t.indexOf(k.toLowerCase()) !== -1);
  }

  function getThumb(entry){
    if (entry.media$thumbnail && entry.media$thumbnail.url) return entry.media$thumbnail.url;
    const div=document.createElement('div');
    div.innerHTML=(entry.content && entry.content.$t) || '';
    const img=div.querySelector('img');
    if (img && img.src) return img.src;
    return '';
  }

  function colorFromString(s){
    let h=0;
    for (let i=0;i<s.length;i++) h = (h*31 + s.charCodeAt(i)) >>> 0;
    const hue = h % 360;
    return `hsl(${hue} 70% 45%)`;
  }

  function normalizeEntry(e){
    const link=(e.link||[]).find(l=>l.rel==='alternate');
    const href=link?link.href:'#';
    const title=e.title && e.title.$t ? e.title.$t : '(no title)';
    const plain=(title+' '+(e.content?e.content.$t.replace(/<[^>]*>/g,' '):'')).trim();
    const thumb=getThumb(e);

    // === EXCLUDE certain posts ===
    if (href.toLowerCase().includes('laurens-lists')) return null;

    const published=e.published && e.published.$t ? new Date(e.published.$t) : new Date(0);
    return { href, published, title, plain, thumb };
  }

  async function fetchPage(startIndex){
    const url=`/feeds/posts/default?alt=json&max-results=${PAGE_SIZE}&start-index=${startIndex}`;
    const res=await fetch(url);
    if (!res.ok) throw new Error('Feed request failed');
    return res.json();
  }

  async function loadAll(){
    let start=1,total=0,got=0;
    while (total<MAX_TO_FETCH){
      const data=await fetchPage(start);
      const feed=data.feed||{};
      const entries=feed.entry||[];
      if (!entries.length) break;
      got=entries.length; total+=got; start+=got;

      const norm=entries.map(normalizeEntry).filter(Boolean).sort((a,b)=>b.published-a.published);

      for (const n of norm){
        for (let i=0;i<boxesState.length;i++){
          const box=boxesState[i];
          if (box.posts.length>=MAX_PER_BOX) continue;
          if (matches(n.plain, box.keywords)){
            box.posts.push(n);
            if (!MULTI_MATCH) break;
          }
        }
      }
      const allFull=boxesState.every(b=>b.posts.length>=MAX_PER_BOX);
      if (allFull) break;
      if (got<PAGE_SIZE) break;
    }
  }

  function card(box){
    const wrap=document.createElement('div');
    wrap.className='ti-card';
    const h=document.createElement('h3');
    h.className='ti-h';
    h.textContent=box.title;
    wrap.appendChild(h);

    const grid=document.createElement('div');
    grid.className='ti-grid';

    if (!box.posts.length){
      const p=document.createElement('div');
      p.textContent='No matching posts yet.';
      p.style.font='13px/1.3 system-ui,Arial';
      p.style.color='#555';
      wrap.appendChild(p);
    } else {
      box.posts.forEach(p=>{
        const a=document.createElement('a');
        a.className='ti-item';
        a.href=p.href;

        if (p.thumb){
          const img=document.createElement('img');
          img.className='ti-thumb';
          img.alt=p.title;
          img.src=p.thumb;
          a.appendChild(img);
        } else {
          const ph=document.createElement('div');
          ph.className='ti-ph';
          ph.style.background=colorFromString(p.title);
          ph.textContent=(p.title||'?').trim().charAt(0).toUpperCase() || '?';
          a.appendChild(ph);
        }

        const t=document.createElement('span');
        t.className='ti-title';
        t.textContent=p.title;
        a.appendChild(t);
        grid.appendChild(a);
      });
      wrap.appendChild(grid);
    }

    const more=document.createElement('a');
    more.className='ti-more';
    more.href=searchUrl(box.keywords);
    wrap.appendChild(more);

    return wrap;
  }

  async function init(){
    try{
      await loadAll();
      boxesState.forEach(b=>root.appendChild(card(b)));
    }catch(e){
      root.textContent='Could not build index.';
      console.error(e);
    }
  }

  init();
})();
</script>
